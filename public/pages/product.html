<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyRice - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">

    <style>
        /* CSS ‡∏´‡∏•‡∏±‡∏Å (‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) */
        :root { 
            --primary: #4CAF50; 
            --dark: #333; 
            --light: #f9f9f9; 
            --dark-color: #212121;
            --light-color: #F5F5F5;
        }
        body { 
            font-family: 'Kanit', sans-serif; 
            margin: 0; 
            background-image: url('../images/background.png');
           color: var(--dark); 
         }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 0 20px; 
        }
        a { 
            text-decoration: none; 
        }
        .navbar .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 20px;
        }
        .navbar .container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        nav ul { list-style: none; display: flex; gap: 20px; padding: 0; margin: 0; }
        nav a { color: var(--dark); transition: 0.3s; }
        nav a.active { color: var(--primary); font-weight: 500; }


        /* Page Header */
        .page-header { 
            background: #e8f5e9; 
            padding: 40px 0; 
            text-align: center; 
            margin-bottom: 40px; 
        }
        .page-header h1 { margin: 0 0 10px 0; color: #2e7d32; }
        .page-header p { color: #555; margin: 0; }

        /* Grid & Card */
        .seedling-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; padding-bottom: 60px; }
        .card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .card-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-content h3 { margin: 0 0 5px 0; font-size: 1.3rem; }
        .card-content p { color: #666; font-size: 0.9rem; margin-bottom: 15px; height: 40px; overflow: hidden; }

        /* Product Info List (‡∏ï‡∏≤‡∏°‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà) */
        .product-info { list-style: none; padding: 0; margin: 0 0 15px 0; font-size: 0.9rem; color: #555; background: #f4f4f4; padding: 10px; border-radius: 8px; }
        .product-info li { margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .product-info li:last-child { margin-bottom: 0; }

        .price { font-size: 1.4rem; color: var(--primary); font-weight: bold; margin-bottom: 10px; }

        /* Stock Status */
        .stock-info { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 15px; align-items: center; }
        .stock-status { padding: 3px 8px; border-radius: 4px; font-weight: 500; }
        .available { background-color: #e8f5e9; color: #2e7d32; }
        .low-stock { background-color: #fff3e0; color: #ef6c00; }
        .out-of-stock { background-color: #ffebee; color: #c62828; }

        /* Button */
        .btn-reserve { display: block; width: 100%; text-align: center; background: var(--primary); color: white; padding: 12px; border-radius: 6px; font-weight: 500; transition: 0.2s; box-sizing: border-box; }
        .btn-reserve:hover { background: #43a047; }
        .btn-reserve.disabled { background: #ccc; pointer-events: none; }

        footer {
            background-color: var(--dark-color);
            color: var(--light-color);
            text-align: center;
            padding: 2rem 0;
        }
    </style>
</head>

<body>

    <header class="navbar">
        <div class="container">
            <a href="../" class="logo">üåæ EasyRice</a>
            <button class="hamburger" id="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav id="navMenu">
            <ul>
                <li><a href="../">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                <li><a href="product.html" class="active">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>
                <li><a href="about.html" >‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</a></li>
                <li><a href="contact.html" >‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</a></li>
            </ul>
        </nav>
            <a href="sign-in.html" class="btn-signin">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
    </header>

    <main>

        <section class="page-header">
            <div class="container">
                <h1>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß</h1>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏î‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ</p>
            </div>
        </section>

        <section class="container">
            <!-- Search & Filter -->
            <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." class="form-control" style="flex: 1; min-width: 200px;" onkeyup="filterProducts()">
                <select id="sortSelect" class="form-control" style="min-width: 150px;" onchange="filterProducts()">
                    <option value="">-- ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö --</option>
                    <option value="price-asc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</option>
                    <option value="price-desc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</option>
                    <option value="name">‡∏ä‡∏∑‡πà‡∏≠ A-Z</option>
                </select>
            </div>

            <div class="seedling-grid" id="productContainer">
                <p style="text-align:center; width:100%;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</p>
            </div>
        </section>

    </main>

     <footer>
        <div class="container">
            <h3>EasyRice Seedling Hub</h3>
            <p>‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏ß‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</p>
            <p style="font-size: 0.8rem; margin-top: 20px; color: #aaa;">&copy; 2024 EasyRice. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="../js/api-client.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
        });

        async function loadProducts() {
            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API
                const productsData = await api.getProducts();
                let products = productsData.data || productsData || [];
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô array ‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                if (products.length === 0) {
                    products = [
                        { id: 1, product_name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105', description: '‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡∏°‡∏µ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏° ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏Ç‡πâ‡∏≤‡∏ß‡∏ô‡∏∏‡πà‡∏°', price: 35, stock: 150, image_url: '../images/jasmine105.png' },
                        { id: 2, product_name: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏£‡∏ã‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà', description: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏≠‡∏∏‡∏î‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏≤‡∏£‡∏ï‡πâ‡∏≤‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏π‡∏•‡∏≠‡∏¥‡∏™‡∏£‡∏∞', price: 45, stock: 25, image_url: '../images/riceberry.png' },
                        { id: 3, product_name: '‡∏Ç‡πâ‡∏≤‡∏ß RD43', description: '‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Ç‡πâ‡∏≤‡∏ß‡∏ó‡∏ô‡πÇ‡∏£‡∏Ñ ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏π‡∏á ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡πÄ‡∏ä‡∏¥‡∏á‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå', price: 30, stock: 200, image_url: '../images/rd43.png' },
                        { id: 4, product_name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ 1', description: '‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Ç‡πâ‡∏≤‡∏ß‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏±‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏î‡∏µ ‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏Å‡∏Ç‡∏≤‡∏ß‡∏ô‡∏ß‡∏•', price: 32, stock: 120, image_url: '../images/pathum1.png' }
                    ];
                }
            
            // 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô allProducts ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô filterProducts()
            allProducts = products;

            const container = document.getElementById('productContainer');
            container.innerHTML = '';

            products.forEach(p => {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏ï‡πá‡∏≠‡∏Å
                let stockClass = 'available';
                let stockText = '‚úÖ ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
                let btnState = '';
                
                if (parseInt(p.stock) <= 0) {
                    stockClass = 'out-of-stock';
                    stockText = '‚ùå ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î';
                    btnState = 'disabled';
                } else if (parseInt(p.stock) < 50) {
                    stockClass = 'low-stock';
                    stockText = '‚ö†Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢';
                }

                const productName = p.product_name || p.name;
                const productDesc = p.description || p.desc;
                const productPrice = p.price;
                const productStock = p.stock;
                const productImg = p.image_url || p.img;

                const html = `
                <div class="card">
                    <img src="${productImg}" alt="${productName}">
                    <div class="card-content">
                        <h3>${productName}</h3>
                        <p>${productDesc}</p>
                        <div class="price">‡∏ø${productPrice} / ‡∏ñ‡∏≤‡∏î</div>
                        <div class="stock-info">
                            <span class="stock-status ${stockClass}">${stockText}</span>
                        </div>
                        <button class="btn-reserve ${btnState}" onclick="goToCheckout(${p.id})" ${btnState ? 'disabled' : ''}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                    </div>
                </div>
                `;
                container.innerHTML += html;
            });
        } catch (error) {
            console.error('Error loading products:', error);
            const container = document.getElementById('productContainer');
            container.innerHTML = '<p style="text-align:center; color: red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message + '</p>';
        }

        function goToCheckout(productId) {
            localStorage.setItem('selectedProductId', productId);
            window.location.href = `checkout.html?id=${productId}`;
        }

        // Filter & Search Function
        function filterProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sortBy = document.getElementById('sortSelect').value;
            let products = allProducts || [];

            // Filter by search
            products = products.filter(p => {
                const name = p.product_name || p.name;
                const desc = p.description || p.desc;
                return name.toLowerCase().includes(searchTerm) || desc.toLowerCase().includes(searchTerm);
            });

            // Sort
            if (sortBy === 'price-asc') {
                products.sort((a, b) => a.price - b.price);
            } else if (sortBy === 'price-desc') {
                products.sort((a, b) => b.price - a.price);
            } else if (sortBy === 'name') {
                products.sort((a, b) => {
                    const nameA = (a.product_name || a.name);
                    const nameB = (b.product_name || b.name);
                    return nameA.localeCompare(nameB, 'th');
                });
            }

            // Redraw
            const container = document.getElementById('productContainer');
            container.innerHTML = '';

            if (products.length === 0) {
                container.innerHTML = '<p style="text-align:center; width:100%; padding: 40px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>';
                return;
            }

            products.forEach(p => {
                const btnState = parseInt(p.stock) === 0 ? 'disabled' : '';
                
                let stockClass = 'available';
                let stockText = '‚úÖ ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
                if (parseInt(p.stock) === 0) {
                    stockClass = 'out-of-stock';
                    stockText = '‚ùå ‡∏´‡∏°‡∏î';
                } else if (parseInt(p.stock) < 50) {
                    stockClass = 'low-stock';
                    stockText = '‚ö†Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢';
                }

                const productName = p.product_name || p.name;
                const productDesc = p.description || p.desc;
                const productPrice = p.price;
                const productImg = p.image_url || p.img;

                const html = `
                <div class="card">
                    <img src="${productImg}" alt="${productName}">
                    <div class="card-content">
                        <h3>${productName}</h3>
                        <p>${productDesc}</p>
                        <div class="price">‡∏ø${productPrice} / ‡∏ñ‡∏≤‡∏î</div>
                        <div class="stock-info">
                            <span class="stock-status ${stockClass}">${stockText}</span>
                        </div>
                        <button class="btn-reserve ${btnState}" onclick="goToCheckout(${p.id})" ${btnState ? 'disabled' : ''}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                    </div>
                </div>
                `;
                container.innerHTML += html;
            });
        }

        // Hamburger Menu
        function toggleMenu() {
            const hamburger = document.getElementById('hamburger');
            const navMenu = document.getElementById('navMenu');
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        }

        document.querySelectorAll('#navMenu a').forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('hamburger').classList.remove('active');
                document.getElementById('navMenu').classList.remove('active');
            });
        });

        // Store products globally for filtering
        let allProducts = [];
    </script>
    <script src="../js/easyrice.js"></script>
</body>
</html>