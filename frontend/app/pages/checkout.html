
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map {
            width: 100% !important;
            height: 400px !important;
            border-radius: 10px;
            border: 2px solid #ddd;
            margin-bottom: 10px;
            display: block !important;
            background: #f0f0f0;
        }
        
        .leaflet-container {
            width: 100% !important;
            height: 400px !important;
        }
    </style>
</head>
<body class="login-page-body">

       <header class="navbar">
        <div class="container">
            <a href="#" class="logo">üåæ EasyRice</a>
            <button class="hamburger" id="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav id="navMenu">
                <ul>
                    <li><a href="index.html" >‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                    <li><a href="product.html" class="active">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>
                    <li><a href="about.html">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</a></li>
                    <li><a href="contact.html">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</a></li>
                </ul>
            </nav>
            <a href="sign-in.html" class="btn-signin">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
    </header>

    <main class="container" style="margin-top: 50px; margin-bottom: 50px;">
        <div class="unified-contact-card" style="grid-template-columns: 1fr 1.5fr;">
            
            <div class="contact-sidebar">
                <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Ç‡πâ‡∏≤‡∏ß</h2>
                <div class="product-preview">
                    <img id="productImage" src="../images/jasmine105.png" alt="‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105" class="order-image">
                    <div class="product-info-text">
                        <strong id="productName">‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Ç‡πâ‡∏≤‡∏ß: ‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105</strong>
                        <p id="growthTime"><i class="fas fa-seedling"></i> ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï: 120 ‡∏ß‡∏±‡∏ô</p>
                        <p id="seedPrice"><i class="fas fa-tag"></i> ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤: 13 ‡∏ö‡∏≤‡∏ó / ‡∏ñ‡∏≤‡∏î</p>
                        <p id="plantingPrice"><i class="fas fa-tractor"></i> ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏Å‡∏î‡∏≥: 1,800 ‡∏ö‡∏≤‡∏ó / ‡πÑ‡∏£‡πà (‡∏£‡∏ß‡∏°‡∏Å‡∏•‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß)</p>
                    </div>
                </div>
                
                <div class="order-notice" style="margin-top: 30px; padding: 15px; background: rgba(255,183,77,0.2); border-radius: 10px;">
                    <p style="color: var(--accent-color); font-weight: bold;">
                        <i class="fas fa-exclamation-triangle"></i> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:
                    </p>
                    <p>‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡∏Ç‡∏≠‡∏á‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ</p>
                </div>
            </div>

            <div class="contact-form-body">
                <h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
                <form id="orderForm">
                    <div class="checkout-grid-form" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" class="form-control" placeholder="08X-XXX-XXXX" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" class="form-control" placeholder="example@gmail.com" required>
                    </div>

                    <div class="form-group">
                        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                        <textarea class="form-control" rows="2" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" required></textarea>
                    </div>

                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</label>
                        <div id="map"></div>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">üí° ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</p>
                        <input type="hidden" id="lat" name="lat">
                        <input type="hidden" id="lng" name="lng">
                    </div>

                    <div class="checkout-grid-form" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
                            <input type="date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select id="deliveryMethod" class="form-control">
                                <option value="self">‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏®‡∏π‡∏ô‡∏¢‡πå</option>
                                <option value="delivery">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" style="background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px dashed var(--primary-color);">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="plantingService" style="width: 20px; height: 20px;">
                            <span>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏Å‡∏î‡∏≥ (1,800 ‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà ‡∏£‡∏ß‡∏°‡∏Å‡∏•‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß)</span>
                        </label>
                    </div>

                    <div class="form-group" id="quantityArea">
                        <label id="quantityLabel">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ñ‡∏≤‡∏î)</label>
                        <input type="number" id="quantity" class="form-control" value="1" min="1">
                    </div>

                    <div class="order-summary-box" style="background: #3D4828; color: #fff; padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                            <strong id="totalPrice">‡∏ø0</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; color: var(--accent-color); font-size: 1.2rem; font-weight: bold;">
                            <span>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥ (50%):</span>
                            <strong id="depositPrice">‡∏ø0</strong>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary full-width" style="margin-top: 20px; height: 55px; font-size: 1.2rem;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                </form>
            </div>
            
        </div>
    </main>

    <div id="orderModal" class="modal-overlay" style="display: none;">
    <div class="login-card modal-content" style="max-width: 600px; padding: 30px;">
        <div class="login-header">
            <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--primary-color);"></i>
            <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
            <p id="orderDateDisplay"></p>
        </div>

        <div class="summary-details" style="text-align: left; margin-bottom: 20px; color: var(--dark-color);">
            <div style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 10px;">
                <p><strong>‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> <span id="resName"></span></p>
                <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> <span id="resPhone"></span></p>
                <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</strong> <span id="resDetails"></span></p>
                <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> <span id="resProduct">‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105</span></p>
                <p id="resQuantity"></p>
                <p id="resQuantity"></p>
                <hr style="margin: 10px 0; border: 0; border-top: 1px solid #ccc;">
                <p style="font-size: 1.2rem;"><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> <span id="resTotal" style="color: var(--primary-color);"></span></p>
                <p style="font-size: 1.3rem; color: #c62828;"><strong>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞ (50%):</strong> <span id="resDeposit"></span></p>
            </div>
        </div>

        <div class="payment-section" style="border: 2px dashed var(--accent-color); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <h3><i class="fas fa-university"></i> ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <p>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (K-Bank)</p>
            <p style="font-size: 1.2rem; font-weight: bold; letter-spacing: 1px;">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: xxx-x-xxxx-xxx</p>
            <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏ö‡∏à‡∏Å. ‡∏≠‡∏µ‡∏ã‡∏µ‡πà‡πÑ‡∏£‡∏ã‡πå (EasyRice Co., Ltd.)</p>
            <div style="margin-top: 10px;">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=EasyRicePayment" alt="QR Payment" style="width: 120px; border: 5px solid #fff;">
                <p style="font-size: 0.8rem; color: #666;">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥</p>
            </div>
        </div>

        <form id="paymentUploadForm">
            <div class="form-group" style="text-align: left;">
                <label><i class="fas fa-file-import"></i> ‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏•‡∏¥‡∏õ)</label>
                <input type="file" id="slipFile" class="form-control" accept="image/*" required>
            </div>
                <button type="button" onclick="finalizeOrder()" class="btn-primary full-width">‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>
            </form>
        </div>
    </div>

    <div class="form-group">
        <label><i class="fas fa-edit"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
        <textarea id="additionalDetails" class="form-control" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Ç‡πâ‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô..."></textarea>
    </div>

    <script>
        let selectedProduct = { id: 1, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105', desc: '‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡∏°‡∏µ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏° ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏Ç‡πâ‡∏≤‡∏ß‡∏ô‡∏∏‡πà‡∏°', age: 25, feature: '‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏°', price: 35, stock: 150, img: '../images/jasmine105.png' };

        document.addEventListener('DOMContentLoaded', function() {
            // Update sign-in button based on login status
            updateSignInButton();
            
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            if (productId) {
                const products = JSON.parse(localStorage.getItem('easyrice_db')) || [];
                const product = products.find(p => p.id == productId);
                if (product) {
                    selectedProduct = product;
                    document.getElementById('productImage').src = selectedProduct.img;
                    document.getElementById('productName').innerText = `‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Ç‡πâ‡∏≤‡∏ß: ${selectedProduct.name}`;
                    document.getElementById('growthTime').innerHTML = `<i class="fas fa-seedling"></i> ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï: ${selectedProduct.age} ‡∏ß‡∏±‡∏ô`;
                    document.getElementById('seedPrice').innerHTML = `<i class="fas fa-tag"></i> ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤: ${selectedProduct.price} ‡∏ö‡∏≤‡∏ó / ‡∏ñ‡∏≤‡∏î`;
                }
            }

            // Initialize map
            console.log('Initializing map...');
            var mapElement = document.getElementById('map');
            console.log('Map element:', mapElement);
            
            if (mapElement) {
                var map = L.map('map', {
                    dragging: true,
                    touchZoom: true,
                    scrollWheelZoom: true
                }).setView([13.7563, 100.5018], 10);
                
                console.log('Map created:', map);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                
                var marker = L.marker([13.7563, 100.5018], { draggable: true }).addTo(map);
                
                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                marker.on('dragend', function() {
                    var coords = marker.getLatLng();
                    document.getElementById('lat').value = coords.lat.toFixed(6);
                    document.getElementById('lng').value = coords.lng.toFixed(6);
                });
                
                // ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                map.on('click', function(e) {
                    marker.setLatLng(e.latlng);
                    document.getElementById('lat').value = e.latlng.lat.toFixed(6);
                    document.getElementById('lng').value = e.latlng.lng.toFixed(6);
                });
                
                document.getElementById('lat').value = 13.7563;
                document.getElementById('lng').value = 100.5018;
            } else {
                console.error('Map element not found!');
            }
        });

        const quantityInput = document.getElementById('quantity');
        const plantingCheck = document.getElementById('plantingService');
        const totalPriceEl = document.getElementById('totalPrice');
        const depositPriceEl = document.getElementById('depositPrice');
        const quantityLabel = document.getElementById('quantityLabel');

        function calculatePrice() {
            let total = 0;
            const qty = parseInt(quantityInput.value) || 0;

            if (plantingCheck.checked) {
                quantityLabel.innerText = "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏£‡πà)";
                total = qty * 1800;
            } else {
                quantityLabel.innerText = "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ñ‡∏≤‡∏î)";
                total = qty * selectedProduct.price;
            }

            const deposit = total * 0.5;

            totalPriceEl.innerText = `‡∏ø${total.toLocaleString()}`;
            depositPriceEl.innerText = `‡∏ø${deposit.toLocaleString()}`;
        }

        quantityInput.addEventListener('input', calculatePrice);
        plantingCheck.addEventListener('change', calculatePrice);
        
        // Initial Calculation
        calculatePrice();

        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Populate modal
            document.getElementById('resName').innerText = document.querySelector('input[placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"]').value;
            document.getElementById('resPhone').innerText = document.querySelector('input[placeholder="08X-XXX-XXXX"]').value;
            document.getElementById('resDetails').innerText = document.getElementById('additionalDetails').value || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏∏";
            document.getElementById('resProduct').innerText = selectedProduct.name;
            document.getElementById('resQuantity').innerText = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${quantityInput.value} ${plantingCheck.checked ? '‡πÑ‡∏£‡πà' : '‡∏ñ‡∏≤‡∏î'}`;
            document.getElementById('resTotal').innerText = totalPriceEl.innerText;
            document.getElementById('resDeposit').innerText = depositPriceEl.innerText;
            document.getElementById('orderDateDisplay').innerText = new Date().toLocaleDateString('th-TH');
            document.getElementById('orderModal').style.display = 'flex';
        });

        function finalizeOrder() {
            const slipFile = document.getElementById('slipFile');
            if (!slipFile.files.length) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                // Get form data
                const name = document.querySelector('input[placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"]').value;
                const phone = document.querySelector('input[placeholder="08X-XXX-XXXX"]').value;
                const email = document.querySelector('input[type="email"]').value;
                const address = document.querySelector('textarea').value;
                const date = document.querySelector('input[type="date"]').value;
                const deliveryMethod = document.getElementById('deliveryMethod').value;

                // Create order object
                const order = {
                    id: 'ER-' + Date.now(),
                    name: name,
                    phone: phone,
                    email: email,
                    address: address,
                    product: selectedProduct.name,
                    quantity: quantityInput.value,
                    total: parseInt(totalPriceEl.innerText.replace('‡∏ø', '').replace(',', '')),
                    deposit: parseInt(depositPriceEl.innerText.replace('‡∏ø', '').replace(',', '')),
                    date: date,
                    deliveryMethod: deliveryMethod,
                    slip: e.target.result,
                    status: 'pending',
                    orderDate: new Date().toISOString()
                };

                // Save to localStorage
                const orders = JSON.parse(localStorage.getItem('easyrice_orders')) || [];
                orders.push(order);
                localStorage.setItem('easyrice_orders', JSON.stringify(orders));
                
                alert('‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');
                location.reload();
            };
            reader.readAsDataURL(slipFile.files[0]);
        }

        // Mobile menu toggle
        function toggleMenu() {
            const hamburger = document.getElementById('hamburger');
            const navMenu = document.getElementById('navMenu');
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        }

        // Close menu when link clicked
        document.querySelectorAll('#navMenu a').forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('hamburger').classList.remove('active');
                document.getElementById('navMenu').classList.remove('active');
            });
        });
    </script>

    <script src="../js/easyrice.js"></script>
</body>
</html>