<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyRice Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .card { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-top: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-save { background: var(--primary-color); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 15px; font-size: 1rem; }
        .btn-save:hover { background: #45a049; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f5f5f5; font-weight: 600; }
        .btn-del { background: #ff5252; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .tab-btn { padding: 10px 20px; background: none; border: none; cursor: pointer; font-size: 1rem; color: #999; transition: 0.3s; }
        .tab-btn.active { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .status-pending { background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; }
        .status-approved { background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="container">
            <a href="index.html" class="logo">üåæ EasyRice</a>
            <nav>
                <ul>
                    <li><a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                    <li><a href="product.html">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>
                    <li><a href="about.html">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</a></li>
                    <li><a href="contact.html">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</a></li>
                </ul>
            </nav>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span id="adminName" style="color: var(--primary-color); font-weight: 500;"></span>
                <button id="logoutBtn" onclick="logout()" style="background: #ff5252; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div style="display: flex; gap: 10px; margin-top: 20px; margin-bottom: 20px; border-bottom: 2px solid #ddd;">
            <button onclick="switchTab('products')" class="tab-btn active"><i class="fas fa-boxes"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button onclick="switchTab('orders')" class="tab-btn"><i class="fas fa-clipboard-list"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            <button onclick="switchTab('stock')" class="tab-btn"><i class="fas fa-warehouse"></i> ‡∏î‡∏π‡∏™‡∏ï‡πä‡∏≠‡∏Å</button>
        </div>

        <!-- TAB 1 -->
        <div id="products" class="tab-content active">
            <div class="card">
                <h3><i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <form id="addForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠</label>
                            <input type="text" id="pName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                            <input type="text" id="pDesc" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏•‡πâ‡∏≤ (‡∏ß‡∏±‡∏ô)</label>
                            <input type="number" id="pAge" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞</label>
                            <input type="text" id="pFeature" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤</label>
                            <input type="number" id="pPrice" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏™‡∏ï‡πá‡∏≠‡∏Å</label>
                            <input type="number" id="pStock" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                        <input type="file" id="pImg" class="form-control" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn-save">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </form>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-list"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <table>
                    <thead>
                        <tr><th>‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
                    </thead>
                    <tbody id="productList"></tbody>
                </table>
            </div>
        </div>

        <!-- TAB 2 -->
        <div id="orders" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-clipboard-list"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
                <table>
                    <thead>
                        <tr><th>#</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏°‡∏±‡∏î‡∏à‡∏≥</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏î‡∏π</th></tr>
                    </thead>
                    <tbody id="orderList"></tbody>
                </table>
            </div>
        </div>

        <!-- TAB 3 -->
        <div id="stock" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-warehouse"></i> ‡∏™‡∏ï‡πä‡∏≠‡∏Å</h3>
                <table>
                    <thead>
                        <tr><th>‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤</th></tr>
                    </thead>
                    <tbody id="stockList"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="orderModal" class="modal-overlay" style="display: none;">
        <div class="login-card modal-content" style="max-width: 600px;">
            <div class="login-header"><h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2></div>
            <div id="orderDetail" style="max-height: 60vh; overflow-y: auto; padding: 20px; text-align: left;"></div>
            <button onclick="acceptOrder()" id="acceptBtn" class="btn-save" style="background: #2196F3;">‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            <button onclick="closeOrderModal()" class="btn-save" style="background: #999; margin-top: 10px;">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        let currentOrderIdx = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('easyrice_admin_logged_in')) {
                alert('‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
                location.href = 'sign-in.html';
                return;
            }
            const name = localStorage.getItem('easyrice_admin_name') || '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•';
            document.getElementById('adminName').textContent = '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ' + name;
            document.getElementById('addForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const img = document.getElementById('pImg');
                if (!img.files.length) { alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ'); return; }
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const p = {
                        id: Date.now(),
                        name: document.getElementById('pName').value,
                        desc: document.getElementById('pDesc').value,
                        age: document.getElementById('pAge').value,
                        feature: document.getElementById('pFeature').value,
                        price: parseInt(document.getElementById('pPrice').value),
                        stock: parseInt(document.getElementById('pStock').value),
                        img: ev.target.result
                    };
                    let products = JSON.parse(localStorage.getItem('easyrice_db')) || [];
                    products.push(p);
                    localStorage.setItem('easyrice_db', JSON.stringify(products));
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                    document.getElementById('addForm').reset();
                    loadProducts();
                    loadStock();
                };
                reader.readAsDataURL(img.files[0]);
            });
            loadProducts();
            loadOrders();
            loadStock();
        });

        function logout() {
            localStorage.removeItem('easyrice_admin_logged_in');
            localStorage.removeItem('easyrice_admin_name');
            location.href = 'index.html';
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            event.target.classList.add('active');
        }

        function loadProducts() {
            let products = JSON.parse(localStorage.getItem('easyrice_db')) || [];
            if (!products.length) {
                products = [
                    {id: 1, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105', desc: '‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏°', age: 25, feature: '‡∏î‡∏µ', price: 35, stock: 150, img: 'https://via.placeholder.com/100'},
                    {id: 2, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏£‡∏ã‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà', desc: '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', age: 30, feature: '‡∏î‡∏µ', price: 45, stock: 25, img: 'https://via.placeholder.com/100'},
                    {id: 3, name: '‡∏Ç‡πâ‡∏≤‡∏ß RD43', desc: '‡∏ó‡∏ô‡πÇ‡∏£‡∏Ñ', age: 20, feature: '‡∏î‡∏µ', price: 30, stock: 200, img: 'https://via.placeholder.com/100'}
                ];
                localStorage.setItem('easyrice_db', JSON.stringify(products));
            }
            const tbody = document.getElementById('productList');
            tbody.innerHTML = '';
            products.forEach(p => {
                tbody.innerHTML += `<tr><td><img src="${p.img}" width="40" style="border-radius:4px;"></td><td>${p.name}</td><td>${p.price}</td><td>${p.stock}</td><td><button onclick="deleteProduct(${p.id})" class="btn-del"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        function deleteProduct(id) {
            if (!confirm('‡∏•‡∏ö?')) return;
            let products = JSON.parse(localStorage.getItem('easyrice_db')) || [];
            products = products.filter(p => p.id !== id);
            localStorage.setItem('easyrice_db', JSON.stringify(products));
            loadProducts();
            loadStock();
        }

        function loadOrders() {
            let orders = JSON.parse(localStorage.getItem('easyrice_orders')) || [];
            const tbody = document.getElementById('orderList');
            tbody.innerHTML = '';
            if (!orders.length) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ</td></tr>';
                return;
            }
            orders.forEach((o, i) => {
                const st = o.status === 'pending' ? '<span class="status-pending">‡∏£‡∏≠</span>' : '<span class="status-approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
                tbody.innerHTML += `<tr><td>${i+1}</td><td>${o.name}</td><td>${o.phone}</td><td>${o.product}</td><td>${o.quantity}</td><td>${o.deposit}</td><td>${st}</td><td><button onclick="showOrder(${i})" style="padding:5px 10px; background:#2196F3; color:#fff; border:0; border-radius:4px; cursor:pointer;"><i class="fas fa-eye"></i></button></td></tr>`;
            });
        }

        function showOrder(i) {
            currentOrderIdx = i;
            let orders = JSON.parse(localStorage.getItem('easyrice_orders')) || [];
            const o = orders[i];
            const slip = o.slip ? `<div style="margin-top:15px;"><strong>‡∏™‡∏•‡∏¥‡∏õ:</strong><img src="${o.slip}" style="max-width:300px; margin-top:10px; border-radius:8px; display:block;"></div>` : '';
            document.getElementById('orderDetail').innerHTML = `
                <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${o.name}</p>
                <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå:</strong> ${o.phone}</p>
                <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> ${o.email || '-'}</p>
                <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${o.address || '-'}</p>
                <p><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${o.product}</p>
                <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</strong> ${o.quantity} ‡∏ñ‡∏≤‡∏î</p>
                <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${o.date || '-'}</p>
                <hr>
                <p style="font-weight:bold;">‡∏£‡∏ß‡∏°: ${o.total} ‡∏ö‡∏≤‡∏ó</p>
                <p style="font-weight:bold;">‡∏°‡∏±‡∏î‡∏à‡∏≥: ${o.deposit} ‡∏ö‡∏≤‡∏ó</p>
                ${slip}
            `;
            document.getElementById('acceptBtn').style.display = o.status === 'pending' ? 'block' : 'none';
            document.getElementById('orderModal').style.display = 'flex';
        }

        function acceptOrder() {
            let orders = JSON.parse(localStorage.getItem('easyrice_orders')) || [];
            orders[currentOrderIdx].status = 'approved';
            localStorage.setItem('easyrice_orders', JSON.stringify(orders));
            alert('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß');
            closeOrderModal();
            loadOrders();
        }

        function closeOrderModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        function loadStock() {
            let products = JSON.parse(localStorage.getItem('easyrice_db')) || [];
            const tbody = document.getElementById('stockList');
            tbody.innerHTML = '';
            let total = 0;
            products.forEach(p => {
                const val = p.price * p.stock;
                total += val;
                tbody.innerHTML += `<tr><td><img src="${p.img}" width="40" style="border-radius:4px;"></td><td>${p.name}</td><td>${p.stock}</td><td>${p.price}</td><td>${val.toLocaleString()}</td></tr>`;
            });
            tbody.innerHTML += `<tr style="background:#f5f5f5; font-weight:bold;"><td colspan="4" style="text-align:right;">‡∏£‡∏ß‡∏°:</td><td>${total.toLocaleString()}</td></tr>`;
        }
    </script>
</body>
</html>